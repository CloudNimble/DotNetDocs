<Project Sdk="Microsoft.Build.NoTargets/3.7.0">

    <PropertyGroup>
        <!-- SDK packages don't compile code -->
        <TargetFramework>netstandard2.0</TargetFramework>
        <GenerateDocumentationFile>false</GenerateDocumentationFile>
        <Description>
            MSBuild SDK for DotNetDocs projects (.docsproj) - provides a clean way to include documentation in .NET
            solutions
        </Description>

        <!-- This is an MSBuild SDK package -->
        <DevelopmentDependency>true</DevelopmentDependency>
        <PackageType>MSBuildSdk</PackageType>
        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>

        <!-- Suppress warnings about SDK packages -->
        <NoWarn>$(NoWarn);NU5128;CS2008;NU1701;NU5100</NoWarn>
        
        <!-- Don't create symbols package for SDK projects -->
        <IncludeSymbols>false</IncludeSymbols>
        
        <!-- Suppress dependencies when packing -->
        <SuppressDependenciesWhenPacking>true</SuppressDependenciesWhenPacking>
    </PropertyGroup>

    <ItemGroup>
        <!-- Include Microsoft.Build.NoTargets for bundling its SDK files -->
        <PackageReference Include="Microsoft.Build.NoTargets"
                          Version="3.7.*"
                          PrivateAssets="all"
                          GeneratePathProperty="true" />
    </ItemGroup>

    <ItemGroup>
        <!-- Pack the SDK files -->
        <None Include="Sdk\**" Pack="true" PackagePath="Sdk" />
        <None Include="build\**" Pack="true" PackagePath="build" />
        
        <!-- Include pre-built task assemblies directly (only during packaging) -->
        <!-- .NET 8.0 tasks -->
        <None Include="..\CloudNimble.DotNetDocs.Sdk.Tasks\bin\$(Configuration)\net8.0\*.dll"
              Pack="true"
              PackagePath="tasks\net8.0"
              Visible="false" />
              
        <!-- .NET 9.0 tasks -->
        <None Include="..\CloudNimble.DotNetDocs.Sdk.Tasks\bin\$(Configuration)\net9.0\*.dll"
              Pack="true"
              PackagePath="tasks\net9.0"
              Visible="false" />
              
        <!-- .NET 10.0 tasks -->
        <None Include="..\CloudNimble.DotNetDocs.Sdk.Tasks\bin\$(Configuration)\net10.0\*.dll"
              Pack="true"
              PackagePath="tasks\net10.0"
              Visible="false" />
              
        <!-- .NET Framework 4.7.2 tasks -->
        <None Include="..\CloudNimble.DotNetDocs.Sdk.Tasks\bin\$(Configuration)\net472\*.dll"
              Pack="true"
              PackagePath="tasks\net472"
              Visible="false" />
    </ItemGroup>
    
    <!-- Build the tasks project before packing this SDK -->
    <Target Name="BuildTasksProject" BeforeTargets="Pack">
        <MSBuild Projects="..\CloudNimble.DotNetDocs.Sdk.Tasks\CloudNimble.DotNetDocs.Sdk.Tasks.csproj"
                 Targets="Build"
                 Properties="Configuration=$(Configuration)" />
        <Message Text="Built CloudNimble.DotNetDocs.Sdk.Tasks" Importance="high" />
    </Target>

    <!-- Include NoTargets SDK files directly from package in NuGet -->
    <Target Name="IncludeNoTargetsInPackage" BeforeTargets="GenerateNuspec">
        <PropertyGroup>
            <NoTargetsSourcePath>$(PkgMicrosoft_Build_NoTargets)\Sdk</NoTargetsSourcePath>
        </PropertyGroup>
        
        <ItemGroup>
            <NoTargetsFiles Include="$(NoTargetsSourcePath)\**\*" />
            <None Include="@(NoTargetsFiles)" Pack="true" PackagePath="Sdk\NoTargets\%(RecursiveDir)%(Filename)%(Extension)" />
        </ItemGroup>
        
        <Message Text="Including NoTargets SDK files in package from $(NoTargetsSourcePath)" Importance="normal" />
    </Target>

</Project>